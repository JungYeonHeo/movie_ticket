<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.movie.mappers.review">

	<!-- 영화 상세 - 리뷰 목록 --> 
	<select id="reviewSelect" resultType="org.movie.DTO.ReviewDTO">
		select * from review where movie_id = #{movie_id}
	</select>
	
	<!-- 영화 상세 - 리뷰 좋아요 클릭 --> 
	<update id="likeCountUpdate">
		update review set recommend_count = #{count} where review_id = #{search}
	</update>
	
	<!-- 마이페이지 - 이미 영화의 리뷰를 작성했는지 확인 -->
	<select id="mypageReviewWriteYN" resultType="org.movie.DTO.ReviewDTO">
		select * from review where member_id = #{member_id} and movie_id = #{movie_id}
	</select>
	
	<!-- 마이페이지 - 예매 목록 리뷰 작성 --> 
	<insert id="reviewInsert">
		insert into review(review_id, member_id, movie_id, review_rate, review_text) value(#{review_id}, #{member_id}, #{movie_id}, #{score}, #{text})
	</insert>
	
	<!-- 마이페이지 - 사용자가 작성한 리뷰 목록 --> 
	<select id="mypageReviewList" resultType="org.movie.DTO.MypageReviewDTO">
		select movie.title_ko, movie.title_en, movie.poster_img, movie.g_rate_id, 
		review.review_rate, review.review_text, review.write_time, review.recommend_count
		from review inner join movie
		on review.movie_id = movie.movie_id
		where member_id = #{member_id}
	</select>
	
</mapper>